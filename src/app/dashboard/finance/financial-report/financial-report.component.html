<app-spinner [isLoading]="isLoading" />
<div class="financial-report__container">
  <h1 class="financial-report__title">Financial Report</h1>
  <div class="filter-fields">
    <mat-form-field appearance="outline">
      <mat-label>Year</mat-label>
      <mat-select [formControl]="yearControl">
        @for (item of getYearsDropDownValues(); track item.value) {
          <mat-option [value]="item.value">{{ item.label }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Period</mat-label>
      <mat-select [formControl]="periodControl">
        @for (item of budgetPeriods; track item.value) {
          <mat-option [value]="item.value">{{ item.label }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>
  <div class="display-style">
    <mat-button-toggle-group [formControl]="displayStyleControl">
      <mat-button-toggle value="chart">Chart</mat-button-toggle>
      <mat-button-toggle value="table">Table</mat-button-toggle>
    </mat-button-toggle-group>
  </div>
  <div class="bar-chart">
    <div class="bar-header">
      <h3 class="bar-chart-title">Budget v Disbursement v Fund</h3>
    </div>
    @if (displayStyleControl.value === 'table') {
      <div class="students-table-container">
        <table
          mat-table
          [dataSource]="accountingRows"
          class="example-table"
          matSort
          matSortActive="created"
          matSortDisableClear
          matSortDirection="desc">
          <!-- Number Column -->
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef>Description</th>
            <td mat-cell *matCellDef="let row">{{ row.description }}</td>
          </ng-container>
          <ng-container matColumnDef="period">
            <th mat-header-cell *matHeaderCellDef>Period</th>
            <td mat-cell *matCellDef="let row">{{ row.period }}</td>
          </ng-container>
          <ng-container matColumnDef="year">
            <th mat-header-cell *matHeaderCellDef>Year</th>
            <td mat-cell *matCellDef="let row">
              {{ row.year }}
            </td>
          </ng-container>
          <!-- Title Column -->
          <ng-container matColumnDef="amount">
            <th mat-header-cell *matHeaderCellDef>Amount</th>
            <td mat-cell *matCellDef="let row">{{ row.amount }}</td>
          </ng-container>

          <!-- State Column -->
          <ng-container matColumnDef="runningTotal">
            <th mat-header-cell *matHeaderCellDef>Running Total</th>
            <td mat-cell *matCellDef="let row">{{ row.runningTotal }}</td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            [class.budget-type]="row.type === 'budget'"
            [class.disbursement-type]="row.type === 'disbursement'"
            [class.fund-type]="row.type === 'fund'"
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            class="row"></tr>
        </table>
      </div>
    } @else {
      <canvas
        baseChart
        [data]="chart()"
        [type]="chartType"
        [options]="chartOptions"></canvas>
    }
  </div>
</div>
