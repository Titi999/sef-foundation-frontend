<app-spinner [isLoading]="isLoadingBudget" />
@if (budgetDistribution) {
  <span class="overview__title">Budget Distribution Upload Preview</span>
  <div class="distribution-table">
    <table
      [fixedLayout]="false"
      mat-table
      [dataSource]="budgetDistribution"
      class="example-table">
      <ng-container matColumnDef="student" [sticky]="true">
        <th mat-header-cell *matHeaderCellDef>Student Code</th>
        <td mat-cell *matCellDef="let row">
          {{ row.studentCode | zeroPad }}
        </td>
      </ng-container>
      <ng-container matColumnDef="school">
        <th mat-header-cell *matHeaderCellDef>School</th>
        <td mat-cell *matCellDef="let row">
          {{ row.school }}
        </td>
      </ng-container>
      <ng-container matColumnDef="class">
        <th mat-header-cell *matHeaderCellDef>Class</th>
        <td mat-cell *matCellDef="let row">
          {{ row.class }}
        </td>
      </ng-container>
      <ng-container matColumnDef="tuition">
        <th mat-header-cell *matHeaderCellDef>Tuition</th>
        <td mat-cell *matCellDef="let row">
          {{ row.tuition | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="textBooks">
        <th mat-header-cell *matHeaderCellDef>Text Books</th>
        <td mat-cell *matCellDef="let row">
          {{ row.textBooks | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="extraClasses">
        <th mat-header-cell *matHeaderCellDef>Extra Classes</th>
        <td mat-cell *matCellDef="let row">
          {{ row.extraClasses | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="examFee">
        <th mat-header-cell *matHeaderCellDef>Exam Fee</th>
        <td mat-cell *matCellDef="let row">
          {{ row.examFee | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="homeCare">
        <th mat-header-cell *matHeaderCellDef>Home Care</th>
        <td mat-cell *matCellDef="let row">
          {{ row.homeCare | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="uniformBag">
        <th mat-header-cell *matHeaderCellDef>Uniform / Bag</th>
        <td mat-cell *matCellDef="let row">
          {{ row.uniformBag | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="excursion">
        <th mat-header-cell *matHeaderCellDef>Excursion</th>
        <td mat-cell *matCellDef="let row">
          {{ row.excursion | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="transportation">
        <th mat-header-cell *matHeaderCellDef>Transportation</th>
        <td mat-cell *matCellDef="let row">
          {{ row.transportation | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="stationery">
        <th mat-header-cell *matHeaderCellDef>Stationery</th>
        <td mat-cell *matCellDef="let row">
          {{ row.stationery | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="wear">
        <th mat-header-cell *matHeaderCellDef>Foot / Under Wears</th>
        <td mat-cell *matCellDef="let row">
          {{ row.wears | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="schoolFeeding">
        <th mat-header-cell *matHeaderCellDef>School Feeding</th>
        <td mat-cell *matCellDef="let row">
          {{ row.schoolFeeding | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="provisions">
        <th mat-header-cell *matHeaderCellDef>Provisions</th>
        <td mat-cell *matCellDef="let row">
          {{ row.stationery | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="total" stickyEnd>
        <th mat-header-cell *matHeaderCellDef>Total</th>
        <td mat-cell *matCellDef="let row">
          {{ row.stationery | currency: 'GH&#8373; ' }}
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        class="row"
        mat-row
        *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
} @else {
  <app-info-card title="Budget Distribution">
    <div viewMode></div>
    <div editMode>
      <div class="upload-wrapper">
        <p>
          <mat-slide-toggle [formControl]="others" color="primary"
            >Others</mat-slide-toggle
          >
        </p>
      </div>
      @if (others.value) {
        <div class="container">
          <mat-form-field appearance="outline">
            <mat-label>Title</mat-label>
            <input
              [matAutocomplete]="auto"
              [formControl]="othersDistributionForm.controls.title"
              matInput />
            <mat-autocomplete #auto="matAutocomplete">
              @for (option of filteredOptions | async; track option) {
                <mat-option [value]="option">{{ option }}</mat-option>
              }
            </mat-autocomplete>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Amount</mat-label>
            <input
              [formControl]="othersDistributionForm.controls.amount"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Comment</mat-label>
            <input
              [formControl]="othersDistributionForm.controls.comment"
              matInput />
          </mat-form-field>
        </div>
      } @else {
        <div class="container">
          <mat-form-field appearance="outline">
            <mat-select
              [formControl]="distributionForm.controls.studentCode"
              placeholder="Student Name"
              #singleSelect>
              <mat-option>
                <ngx-mat-select-search
                  ngxMatSelectSearchClear="fsdfsd"
                  placeholderLabel="Search Students"
                  noEntriesFoundLabel="No student found"
                  [formControl]="studentsFilterCtrl"></ngx-mat-select-search>
              </mat-option>
              <mat-option
                *ngFor="let student of filteredStudents | async"
                [value]="student.code">
                {{ student.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>School</mat-label>
            <input [formControl]="distributionForm.controls.school" matInput />
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Class</mat-label>
            <input [formControl]="distributionForm.controls.class" matInput />
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Tuition</mat-label>
            <input
              [formControl]="distributionForm.controls.tuition"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Text Books</mat-label>
            <input
              [formControl]="distributionForm.controls.textBooks"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Extra Classes</mat-label>
            <input
              [formControl]="distributionForm.controls.extraClasses"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Exam Fee</mat-label>
            <input
              [formControl]="distributionForm.controls.examFee"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Uniform or Bag</mat-label>
            <input
              [formControl]="distributionForm.controls.uniformBag"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Excursion</mat-label>
            <input
              [formControl]="distributionForm.controls.excursion"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Transportation</mat-label>
            <input
              [formControl]="distributionForm.controls.transportation"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Stationery</mat-label>
            <input
              [formControl]="distributionForm.controls.stationery"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Foot or Under Wears</mat-label>
            <input
              [formControl]="distributionForm.controls.wears"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>School Feeding</mat-label>
            <input
              [formControl]="distributionForm.controls.schoolFeeding"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>School Feeding</mat-label>
            <input
              [formControl]="distributionForm.controls.schoolFeeding"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Provisions</mat-label>
            <input
              [formControl]="distributionForm.controls.provision"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Home Care</mat-label>
            <input
              [formControl]="distributionForm.controls.homeCare"
              matInput
              type="number"
              class="currency-right-align"
              placeholder="0" />
            <span matTextPrefix>GH&#8373;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span matTextSuffix>.00</span>
          </mat-form-field>
        </div>
        <div class="total-distribution">
          <mat-chip class="status__chip__active">
            <span>Total Distribution: GH&#8373; {{ updateTotal() }}</span>
          </mat-chip>
        </div>
      }
    </div>
  </app-info-card>
}
<div class="actions">
  <button
    (click)="cancel()"
    [disabled]="isLoading"
    class="submit__btn cancel"
    mat-flat-button
    mat-dialog-close
    type="button">
    <span>Cancel</span>
  </button>
  <button
    [disabled]="isLoading"
    class="submit__btn"
    mat-flat-button
    color="primary"
    (click)="submit()"
    type="submit">
    @if (isLoading) {
      <span class="loading">Loading...</span>
    } @else {
      <span>Save</span>
    }
  </button>
</div>
